{"version":3,"file":"cipher.js","sources":["../js/Components/Component.mjs","../js/Util/base16.mjs","../js/Script.mjs","../js/Util/encode.mjs","../js/Password.mjs","../js/Util/sha256.mjs","../js/Cipher.mjs","../js/Components/Decrypt.mjs","../js/Util/decode.mjs","../js/Event.mjs","../js/Components/FormControl.mjs","../js/Components/Fieldset.mjs","../js/Components/Encrypt.mjs","../js/Components/Login.mjs","../js/Components/Register.mjs","../js/Components.mjs","../js/index.js"],"sourcesContent":["/**\n * @abstract\n */\nexport default class Component {\n    /**\n     * @param {HTMLElement} node \n     * @param {Object} _context \n     */\n    constructor(node, _context) {\n        /**\n         * @property {HTMLElement} node\n         */\n        this.node = node\n    }\n}","/**\n * Class responsible for encoding and decoding base16 (hexadecimal).\n */\nexport default class base16 {\n    static encode(data) {\n        return Array\n            .from(new Uint8Array(data))\n            .map((b) => b.toString(16).padStart(2, '0'))\n            .join('')\n    }\n\n    static decode(string) {\n        return new Uint8Array(string.match(/../g).map(h => parseInt(h, 16))).buffer\n    }\n}","export default class Script {\n    static #script = document.currentScript\n\n    static data = this.#script.getAttribute('data')\n\n    static event = this.#script.getAttribute('event')\n\n    static salt = this.#script.getAttribute('salt')\n\n    static storage = this.#script.getAttribute('storage')\n}","export default function encode(value) {\n    return new TextEncoder().encode(value)\n}","import Script from \"./Script.mjs\";\n\nimport base16 from \"./Util/base16.mjs\";\nimport encode from \"./Util/encode.mjs\";\nimport sha256 from \"./Util/sha256.mjs\";\n\nexport default class Password {\n    /** @type {Promise<ArrayBuffer>} - The private, client-side password hash. */\n    #hash\n\n    /** @type {Promise<ArrayBuffer> | null} - The 'shareable', server-side password hash. */\n    hash\n\n    static salt = Script.salt\n\n    static storage = Script.storage\n\n    static token = Script.token\n\n    /**\n     * @param {{ clientHash: ArrayBufferLike, serverHash: ArrayBufferLike }} param0 \n     */\n    constructor({ clientHash, serverHash = null }) {\n        this.#hash = clientHash\n\n        this.hash = serverHash\n    }\n\n    /**\n     * Initialize a password instance by hashing a plaintext password.\n     * \n     * @param {string} plaintext \n     * @returns {Password}\n     */\n    static hash(plaintext) {\n        const\n            salt = this.salt,\n            hash = input => sha256(encode(input)),\n            clientHash = hash(plaintext + salt),\n            serverHash = hash(salt + plaintext)\n\n        return new this({ clientHash, serverHash })\n    }\n\n    /**\n     * Recall a previously stored instance from local storage.\n     * \n     * @returns {Promise<Password>}\n     */\n    static async recall() {\n        const\n            stored = localStorage.getItem(this.storage),\n            clientHash = base16.decode(stored)\n\n        return new this({ clientHash })\n    }\n\n    /**\n     * Store the password hash in local storage, so it may be\n     * recalled in a subsequent request post-authentication.\n     * \n     * @returns {Promise<Password>}\n     */\n    async remember() {\n        localStorage.setItem(\n            Password.storage,\n            base16.encode(await this.#hash)\n        )\n\n        return this\n    }\n\n    /**\n     * Use the password to unwrap (decrypt) the given wrapped key using the given salt.\n     * \n     * @param {ArrayBufferLike} wrappedKey \n     * @param {ArrayBufferLike} salt \n     * @returns \n     */\n    async unwrap(wrappedKey, salt, unwrappedKeyAlgorithm = { name: 'RSA-OAEP', hash: 'SHA-256' }) {\n        const\n            unwrappingKey = await this.#wrappingKey(salt),\n            unwrappedKey = await crypto.subtle.unwrapKey(\n                'pkcs8',\n                wrappedKey,\n                unwrappingKey,\n                { name: 'AES-GCM', iv: salt },\n                unwrappedKeyAlgorithm,\n                true,\n                ['decrypt']\n            )\n\n        return unwrappedKey\n    }\n\n    /**\n     * Use the password to wrap (encrypt) the given key using the given salt.\n     * \n     * @param {CryptoKey} key \n     * @param {ArrayBufferLike} salt \n     */\n    async wrap(key, salt) {\n        const\n            wrappingKey = await this.#wrappingKey(salt),\n            wrappedKey = await crypto.subtle.wrapKey(\n                'pkcs8',\n                key,\n                wrappingKey,\n                { name: 'AES-GCM', iv: salt }\n            )\n\n        return wrappedKey\n    }\n\n    /**\n     * Get the wrapping key for the given salt.\n     * \n     * @param {ArrayBufferLike} salt \n     * @returns {Promise<CryptoKey>}\n     */\n    async #wrappingKey(salt) {\n        const baseKey = await crypto.subtle.importKey(\n            'raw',\n            await this.#hash,\n            'PBKDF2',\n            false,\n            ['deriveBits', 'deriveKey'],\n        )\n\n        return await crypto.subtle.deriveKey(\n            {\n                salt,\n                name: 'PBKDF2',\n                iterations: 100000,\n                hash: 'SHA-256',\n            },\n            baseKey,\n            { 'name': 'AES-GCM', 'length': 256 },\n            true,\n            ['encrypt', 'decrypt', 'wrapKey', 'unwrapKey'],\n        )\n    }\n}","export default function sha256(data) {\n    return crypto.subtle.digest(\n        'SHA-256',\n        data\n    )\n}","import Password from \"./Password.mjs\"\nimport Script from \"./Script.mjs\"\n\nimport base16 from \"./Util/base16.mjs\"\n\nexport default class Cipher {\n    /**\n     * @param {{ salt: ArrayBufferLike, privateKey: CryptoKey, publicKey: CryptoKey }}\n     */\n    constructor({ privateKey, publicKey, salt }) {\n        this.privateKey = privateKey\n\n        this.publicKey = publicKey\n\n        this.salt = salt\n    }\n\n    /**\n     * Encrypt sensitive data using the given password and export the data.\n     * \n     * @param {Password} [Ã¥password]\n     * @returns {Promise<{ k: string, p: string, s: string }>}\n     */\n    async export(password = null) {\n        password ??= await Password.recall()\n\n        const\n            wrappedPrivateKey = password.wrap(this.privateKey, this.salt),\n            exportedPublicKey = crypto.subtle.exportKey(\n                'spki',\n                this.publicKey\n            )\n\n        return {\n            k: base16.encode(await wrappedPrivateKey),\n            p: base16.encode(await exportedPublicKey),\n            s: base16.encode(this.salt)\n        }\n    }\n\n    /**\n     * Generate a new cipher.\n     * \n     * @returns {Promise<Cipher>}\n     */\n    static async generate() {\n        const\n            [salt, keyPair] = await Promise.all([\n                crypto.getRandomValues(new Uint8Array(16)),\n                crypto.subtle.generateKey(\n                    {\n                        name: 'RSA-OAEP',\n                        modulusLength: 4096,\n                        publicExponent: new Uint8Array([1, 0, 1]),\n                        hash: 'SHA-256'\n                    },\n                    true,\n                    ['encrypt', 'decrypt', 'wrapKey', 'unwrapKey']\n                )\n            ]),\n            privateKey = keyPair.privateKey,\n            publicKey = keyPair.publicKey\n\n        return new this({ salt, privateKey, publicKey })\n    }\n\n    /**\n     * Parse and decrypt previously exported cipher data using the given password.\n     * \n     * @param {{ k: string, p: string, s: string }}\n     * @param {Password} [password]\n     * @returns {Promise<Cipher>}\n     */\n    static async import({ k, p, s }, password = null) {\n        password ??= await Password.recall()\n\n        const\n            salt = base16.decode(s),\n            exportedPublicKey = base16.decode(p),\n            wrappedPrivateKey = base16.decode(k)\n\n        const [privateKey, publicKey] = await Promise.all([\n            password.unwrap(wrappedPrivateKey, salt),\n            crypto.subtle.importKey(\n                'spki',\n                exportedPublicKey,\n                {\n                    name: 'RSA-OAEP',\n                    hash: 'SHA-256'\n                },\n                true,\n                ['encrypt', 'wrapKey']\n            )\n        ])\n\n        return new this({\n            privateKey,\n            publicKey,\n            salt,\n        })\n    }\n\n    /**\n     * Resolve the cipher of currently authenticated user.\n     * \n     * @returns {Promise<Cipher | null>}\n     */\n    static resolve() {\n        const json = Script.data\n\n        return json\n            ? this.import(JSON.parse(json))\n            : null\n    }\n}","import Component from \"./Component.mjs\";\n\nimport base16 from \"../Util/base16.mjs\";\nimport Cipher from \"../Cipher.mjs\";\nimport decode from \"../Util/decode.mjs\";\n\nexport default class Decrypt extends Component {\n    constructor(node) {\n        super(node)\n\n        this.decrypt()\n    }\n\n    async decrypt() {\n        const\n            cipher = await Cipher.resolve(),\n            privateKey = cipher.privateKey,\n            ciphertext = base16.decode(this.node.innerText),\n            plaintext = await crypto.subtle.decrypt(\n                { name: 'RSA-OAEP' },\n                privateKey,\n                ciphertext\n            )\n\n        this.node.innerText = decode(plaintext)\n\n        this.node.hidden = false\n    }\n}","export default function decode(value) {\n    return new TextDecoder().decode(value)\n}","import Script from \"./Script.mjs\"\n\n/**\n * Class responsible for managing events.\n */\nexport default class Event {\n    /**\n     * The name of the event that will be dispatched at the end of\n     * an event interception cycle and, unless stopped, will bubble\n     * to the root and trigger the \"final\" callback.\n     */\n    static event = Script.event\n\n    /** \n     * The event targets and their respective callback stacks, grouped by event type.\n     * \n     * @type {Object<string, WeakMap<EventTarget, {callbacks: ((event: Event) => any)[], final?: (event: Event) => any}>>}\n     */\n    static targets = {}\n\n    /**\n     * Fluently begin constructing a new event interception definition.\n     * \n     * @param {string} event \n     * @returns \n     */\n    static intercept(event) {\n        return new class {\n            /**\n             * Set the event target.\n             * \n             * @param {EventTarget} target \n             * @returns {this}\n             */\n            on(target) {\n                const targets = Event.targets[event] ??= new WeakMap\n\n                if (!targets.has(target)) {\n                    targets.set(target, {\n                        callbacks: []\n                    })\n\n                    Event.#listen(event, target)\n                }\n\n                this.target = targets.get(target)\n\n                return this\n            }\n\n            /**\n             * Add a callback to be run while intercepting event.\n             * \n             * @param {(event: Event) => any} callback \n             * @returns \n             */\n            then(callback) {\n                this.target.callbacks.push(callback)\n\n                return this\n            }\n\n            /**\n             * Set the callback to be run at the end once.\n             * \n             * @param {(event: Event) => any} callback \n             */\n            finally(callback) {\n                this.target.final = callback\n            }\n        }\n    }\n\n    /**\n     * Add the event listener for the given event type and target.\n     * \n     * @param {string} type\n     * @param {EventTarget} target \n     */\n    static #listen(type, target) {\n        target.addEventListener(type, async event => {\n            event.preventDefault()\n\n            const\n                targets = this.targets[type],\n                listener = targets.get(target),\n                callbacks = listener.callbacks,\n                promises = callbacks.map(callback => callback())\n\n            await Promise.all(promises)\n\n            target.dispatchEvent(new CustomEvent(this.event, {\n                bubbles: true,\n                detail: { type }\n            }))\n        })\n\n        document.addEventListener(this.event, event => {\n            if (\n                event.target != target ||\n                event.detail.type != type\n            ) {\n                return\n            }\n\n            this.targets[type].get(target).final(event)\n        })\n    }\n}","import Component from \"./Component.mjs\";\nimport Event from \"../Event.mjs\";\n\n/**\n * @abstract\n */\nexport default class FormControl extends Component {\n    /** @type {HTMLFormElement} */\n    get form() {\n        return this.node.form\n    }\n\n    /**\n     * Intercept the submit event for the component's form using the given callback.\n     * \n     * @param {(event: Event) => any} callback \n     * @returns {void}\n     */\n    onSubmit(callback) {\n        if (!this.form) {\n            throw new Error(`Cipher component \"${this.constructor.name.toLowerCase()}\" must be inside <form> element to intercept submit.`)\n        }\n\n        Event.intercept('submit')\n            .on(this.form)\n            .then(callback.bind(this))\n            .finally(() => this.form.submit())\n    }\n}","import FormControl from \"./FormControl.mjs\";\n\n/**\n * @abstract\n * @property {HTMLFieldSetElement} node\n */\nexport default class Fieldset extends FormControl {\n    /**\n     * Get the form input element with given name.\n     * \n     * @param {string} name \n     * @returns \n     */\n    input(name) {\n        const\n            attribute = 'data-cipher-input',\n            items = this.inputs(name)\n\n        items.forEach(item => item.setAttribute(attribute, name))\n\n        return this.form.querySelector(`[${attribute}='${name}']`)\n    }\n\n    /**\n     * Get all the form control elements with the given name.\n     * \n     * @param {string} name \n     * @returns {HTMLElement[]}\n     */\n    inputs(name) {\n        const\n            item = this.form.elements.namedItem(name),\n            items = typeof item[Symbol.iterator] === 'function'\n                ? [...item]\n                : [item]\n\n        return items.filter(item => !this.node.contains(item))\n    }\n\n    /**\n     * Append to fieldset 'output' field of given \"name\" and \"value\".\n     * \n     * @param {string} name \n     * @param {string} value \n     * @param {boolean} overwrite\n     * @returns \n     */\n    output(name, value, overwrite = true) {\n        const output = this.node.elements.namedItem(name) ?? document.createElement('input')\n\n        output.type = 'hidden'\n        output.name = name\n        output.value = value\n\n        if (!this.node.contains(output)) {\n            this.node.appendChild(output)\n        }\n\n        if (overwrite) {\n            this.inputs(name).forEach(item => item.removeAttribute('name'))\n        }\n\n        return output\n    }\n}","import Fieldset from \"./Fieldset.mjs\";\n\nimport base16 from \"../Util/base16.mjs\";\nimport encode from \"../Util/encode.mjs\";\n\nexport default class Encrypt extends Fieldset {\n    constructor(node, { target, key }) {\n        super(node)\n\n        this.target = target\n\n        this.publicKey = key\n\n        this.onSubmit(this.encrypt)\n    }\n\n    async encrypt() {\n        const\n            plaintext = this.input(this.target).value,\n            publicKey = await crypto.subtle.importKey(\n                'spki',\n                base16.decode(this.publicKey),\n                {\n                    name: 'RSA-OAEP',\n                    hash: 'SHA-256'\n                },\n                true,\n                ['encrypt']\n            ),\n            ciphertext = await crypto.subtle.encrypt(\n                { name: 'RSA-OAEP' },\n                publicKey,\n                encode(plaintext)\n            )\n\n        this.output(this.target, base16.encode(ciphertext))\n    }\n}","import Fieldset from \"./Fieldset.mjs\";\nimport Password from \"../Password.mjs\";\n\nimport base16 from \"../Util/base16.mjs\";\n\nexport default class Login extends Fieldset {\n    constructor(node, { password }) {\n        super(node)\n\n        this.password = password\n\n        this.onSubmit(this.login)\n    }\n\n    async login() {\n        const\n            plaintextPassword = this.input(this.password).value,\n            password = await Password.hash(plaintextPassword).remember()\n\n        this.output(this.password, base16.encode(await password.hash))\n    }\n}","import Cipher from \"../Cipher.mjs\";\nimport Fieldset from \"./Fieldset.mjs\";\nimport Password from \"../Password.mjs\";\n\nimport base16 from \"../Util/base16.mjs\";\n\nexport default class Register extends Fieldset {\n    constructor(node, { password, confirmation }) {\n        super(node)\n\n        this.password = password\n        this.confirmation = confirmation\n\n        this.onSubmit(this.register)\n    }\n\n    async register() {\n        const\n            plaintextPassword = this.input(this.password).value,\n            password = await Password.hash(plaintextPassword).remember()\n\n        this.output(this.password, base16.encode(await password.hash))\n\n        if (this.confirmation) {\n            const\n                passwordConfirmed = this.input(this.confirmation).value,\n                confirmationHash = Password.hash(passwordConfirmed).hash\n\n            this.output(\n                this.confirmation,\n                base16.encode(await confirmationHash)\n            )\n        }\n\n        const\n            cipher = await Cipher.generate(),\n            exported = await cipher.export(password),\n            json = JSON.stringify(exported)\n\n        this.output('_cipher', json)\n    }\n}","import Component from \"./Components/Component.mjs\"\nimport Decrypt from \"./Components/Decrypt.mjs\"\nimport Encrypt from \"./Components/Encrypt.mjs\"\nimport Login from \"./Components/Login.mjs\"\nimport Register from \"./Components/Register.mjs\"\n\n/**\n * Class responsible for mapping and loading the cipher components.\n */\nexport default class Components {\n    /**\n     * @type {Object.<string, typeof Component>}\n     */\n    static types = {\n        decrypt: Decrypt,\n        encrypt: Encrypt,\n        login: Login,\n        register: Register,\n    }\n\n    /**\n     * Load components on the page.\n     */\n    static load() {\n        document.querySelectorAll('[data-cipher-component]').forEach(node => {\n            const\n                name = node.dataset.cipherComponent,\n                type = this.types[name],\n                attributes = JSON.parse(node.dataset.cipherAttributes),\n                component = new type(node, attributes)\n\n            return component\n        })\n    }\n}","import Components from \"./Components.mjs\";\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    Components.load()\n})"],"names":["Component","constructor","node","_context","this","base16","static","data","Array","from","Uint8Array","map","b","toString","padStart","join","string","match","h","parseInt","buffer","Script","document","currentScript","script","getAttribute","encode","value","TextEncoder","Password","hash","salt","storage","token","clientHash","serverHash","plaintext","input","sha256","crypto","subtle","digest","stored","localStorage","getItem","decode","async","setItem","wrappedKey","unwrappedKeyAlgorithm","name","unwrappingKey","wrappingKey","unwrapKey","iv","key","wrapKey","baseKey","importKey","deriveKey","iterations","length","Cipher","privateKey","publicKey","password","recall","wrappedPrivateKey","wrap","exportedPublicKey","exportKey","k","p","s","keyPair","Promise","all","getRandomValues","generateKey","modulusLength","publicExponent","unwrap","json","import","JSON","parse","Decrypt","super","decrypt","resolve","ciphertext","innerText","TextDecoder","hidden","Event","event","on","target","targets","WeakMap","has","set","callbacks","listen","get","then","callback","push","finally","final","type","addEventListener","preventDefault","promises","dispatchEvent","CustomEvent","bubbles","detail","FormControl","form","onSubmit","Error","toLowerCase","intercept","bind","submit","Fieldset","attribute","inputs","forEach","item","setAttribute","querySelector","elements","namedItem","Symbol","iterator","filter","contains","output","overwrite","createElement","appendChild","removeAttribute","Encrypt","encrypt","Login","login","plaintextPassword","remember","Register","confirmation","register","passwordConfirmed","confirmationHash","cipher","generate","exported","export","stringify","Components","querySelectorAll","dataset","cipherComponent","types","cipherAttributes","component","load"],"mappings":"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"}